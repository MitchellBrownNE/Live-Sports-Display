{% load static %}
<!DOCTYPE html>
<html>

<head>
    <link rel="icon" type="image/png" href="{% static 'images/MMM_Mini_Logo.png' %}">
    <link rel="stylesheet" href="{% static 'style_sheet.css' %}">
</head>

<body>
    <div class="header">
        <img src="{% static 'images/MMM_Logo.png' %}" alt="Motion Matrix Media Logo">
        <ul class="nav">
            <li><a href="/home/">Home</a></li>
            <li><a href="/upload/">Upload Roster</a></li>
            <li><a href="#game-schedule">Game Schedule</a></li>
        </ul>
    </div>
    <textarea id="names" rows="10" cols="50">{{ text }}</textarea>

    <div class="message">
        <p> Enter the name of any player who is missing and/or remove any unwanted players</p>
    </div>
    <div id="errorMessage" style="color: red; display: none;">Duplicate names are not allowed!</div>

    <input type="text" id="newNameInput">
    <button onclick="addNewName()" class="add-button">Click to Confirm Name</button>

    <div id="buttonContainer"></div>

    <button onclick="sendPlayers()">Click to confirm and send players</button>
    <button onclick="confirmPlayers()">Click to confirm players to be sent to the display</button>

    <script>

        // Get the textarea element by its id
        let textarea = document.getElementById('names');

        // Get the value (text content) of the textarea
        let text = textarea.value;

        let playerArray = text.split(', ');
        // Display the text in the HTML document
        let buttonContainer = document.getElementById('buttonContainer');

        // Loop through the array and create a button for each item

        playerArray.forEach(function (item) {
            let container = document.createElement('div'); // Container for button and "x"
            container.classList.add('item-container');

            let button = document.createElement('button');
            button.textContent = item;
            button.classList.add('custom-button');
            container.appendChild(button);

            let closeButton = document.createElement('span');
            closeButton.textContent = 'x';
            closeButton.classList.add('close-button');
            closeButton.addEventListener('click', function () {
                let index = playerArray.indexOf(item);
                if (index !== -1) {
                    playerArray.splice(index, 1); // Remove item from array
                    container.remove(); // Remove the container (button + "x")
                }
            });
            container.appendChild(closeButton);

            buttonContainer.appendChild(container);
        });

        function addNewName() {
            let newNameInput = document.getElementById('newNameInput');
            let newName = newNameInput.value.trim();
            let isDup = false;
            if (newName !== '') {
                for (let i = 0; i < playerArray.length; i++) {
                    if (playerArray[i] === newName) {
                        isDup = true;
                        break;
                    }
                }
                if (isDup === false) {
                    errorMessage.style.display = 'none';
                    playerArray.push(newName); // Add the new name to the array

                    let container = document.createElement('div'); // Container for button and "x"
                    container.classList.add('item-container');

                    let button = document.createElement('button');
                    button.textContent = newName;
                    button.classList.add('custom-button');
                    container.appendChild(button);

                    let closeButton = document.createElement('span');
                    closeButton.textContent = 'x';
                    closeButton.classList.add('close-button');
                    closeButton.addEventListener('click', function () {
                        let index = playerArray.indexOf(newName);
                        if (index !== -1) {
                            playerArray.splice(index, 1); // Remove item from array
                            container.remove(); // Remove the container (button + "x")
                        }
                    });
                    container.appendChild(closeButton);

                    buttonContainer.appendChild(container);
                }
                else {
                    errorMessage.style.display = 'block';
                }

                newNameInput.value = ''; // Clear the input field after adding the name
            }
        }
        function sendPlayers() {          
            let form = document.createElement('form');
            form.setAttribute('method', 'POST');
            form.setAttribute('action', '/OCRStats/'); // Replace '/player_list/' with your Django view URL

            // Create a hidden input field for each player name
            playerArray.forEach(player => {
                let input = document.createElement('input');
                input.setAttribute('type', 'hidden');
                input.setAttribute('name', 'players[]'); // Use 'players[]' to send as an array
                input.setAttribute('value', player); // Set the player name as the input value
                form.appendChild(input); // Append the input field to the form
            });

            // Append the form to the document body and submit it
            document.body.appendChild(form);
            form.submit();
        }
    

        function confirmPlayers() {
            let playerString = playerArray.join(','); //NEEDED FOR SSH CALL PLS DONT DELETE
            alert('Sending players: ' + playerString); // ^^^^^^
            }
    </script>
    <div id="buttonContainer"></div>
    <button id="singleDisplayBtn">Single Display</button>
    <button id="stackedDisplayBtn">Stacked Display</button>
    <div id="confirmationStatus"></div>
    <script>
        document.getElementById("singleDisplayBtn").onclick = function () {
            let playerString = playerArray.join(', ');
        
            fetch('/run-single-display/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({ action: 'stackedDisplay', players: playerString })
            }).then(response => response.json())
                .then(data => {
                    document.getElementById("confirmationStatus").innerText = data.message;
                }).catch(error => console.error('Error:', error));
        };
        
        document.getElementById("stackedDisplayBtn").onclick = function () {
            let playerString = playerArray.join(', ');
        
            fetch('/run-stacked-display/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({ action: 'stackedDisplay', players: playerString })
            }).then(response => response.json())
                .then(data => {
                    document.getElementById("confirmationStatus").innerText = data.message;
                }).catch(error => console.error('Error:', error));
        };

        

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>
</body>
</html>
